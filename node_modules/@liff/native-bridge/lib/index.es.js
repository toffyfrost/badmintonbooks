import{LIFF_EVENT as t,INVALID_ARGUMENT as e,FORBIDDEN as i}from"@liff/consts";import{logger as o}from"@liff/logger";import{createLiffError as n,randomAlphaNumericString as a}from"@liff/util";import{getFeatureToken as r}from"@liff/store";import{__assign as d}from"tslib";function l(e){return new CustomEvent(t,{detail:e})}!function(){if("undefined"!=typeof window&&"function"!=typeof window.CustomEvent){function t(t,e){var i=e||{},o=i.bubbles,n=void 0!==o&&o,a=i.cancelable,r=void 0!==a&&a,d=i.detail,l=void 0===d?void 0:d,f=document.createEvent("CustomEvent");return f.initCustomEvent(t,n,r,l),f}t.prototype=Event.prototype,window.CustomEvent=t}}();var f={},c=!1;function s(e,i){c||(c=!0,window.addEventListener(t,(function(t){t&&t.detail&&t.detail.type&&f[t.detail.type]&&f[t.detail.type].forEach((function(e){return e(t)}))}))),f[e]?f[e].push(i):f[e]=[i]}function u(t,e){var i=f[t];if(i&&Array.isArray(i)){var o=i.indexOf(e);o>=0&&i.splice(o,1)}}function v(t){var i={};try{i=JSON.parse(t)}catch(r){throw n(e,r.message)}var a=l(i);o.debug("[client dispatchEvent to js]",{type:a.type,detail:a.detail}),window.dispatchEvent(a)}function p(t,a,d){void 0===a&&(a={}),void 0===d&&(d="");var l=r();if(!l)throw n(i,"Invalid featureToken for client features");if(!window._liff||!window._liff.postMessage)throw n(e,"postMessage is not available from client");o.debug("[js postMessage to client]",t,d,a),window._liff.postMessage(t,l,d,JSON.stringify(a))}function w(t,e,l){return void 0===e&&(e={}),void 0===l&&(l={once:!0}),r()?(l=d({callbackId:a(12),once:!0},l),new Promise((function(i,n){var a=function(e){if(e&&e.detail){var r=e.detail.callbackId===l.callbackId,d="string"!=typeof e.detail.callbackId;(r||d)&&(l.once&&u(t,a),o.debug("[callback detail]",e.detail),e.detail.error?n(e.detail.error):e.detail.data?i(e.detail.data):n(e.detail))}n()};s(t,a),p(t,e,l.callbackId)}))):Promise.reject(n(i,"Invalid featureToken for client features"))}export{s as addListener,w as call,l as createEvent,v as dispatch,p as postMessage,u as removeListener};
