"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("@liff/consts"),n=require("@liff/util"),i=require("@liff/store"),r=require("@liff/is-in-client"),o=require("@liff/use"),u=function(){function e(){}return e.prototype.invoke=function(){return n.isSubWindow()},e}(),f=function(){function e(e){this.storage=e}return Object.defineProperty(e,"IN_SUB_WINDOW_KEY",{get:function(){return"inSubWindow"},enumerable:!1,configurable:!0}),e.prototype.invoke=function(){return new URLSearchParams(window.location.search).has(t.SUB_WINDOW_IDNTIFICATION_KEY)&&this.setInSubWindow(!0),!(!this.getInSubWindow()&&!this.getSubWindowIdentifier())},e.prototype.getInSubWindow=function(){var n=this.storage.getItem("".concat(t.STORE_KEY,":").concat(this.getLiffId(),":").concat(e.IN_SUB_WINDOW_KEY));return null!==n&&JSON.parse(n)},e.prototype.getSubWindowIdentifier=function(){var e,t,n="liff.subwindow.identifier",i=new URLSearchParams(window.location.search);return i.get(n)||(e=n,(t=i.get("liff.state"))?new URLSearchParams(t).get(e):null)||null},e.prototype.setInSubWindow=function(n){this.storage.setItem("".concat(t.STORE_KEY,":").concat(this.getLiffId(),":").concat(e.IN_SUB_WINDOW_KEY),String(n))},e.prototype.getLiffId=function(){var e=i.getConfig().liffId;if(!e)throw n.createLiffError(t.INVALID_CONFIG,"liffId is necessary for liff.init()");return e},e}(),s=function(t){function i(){var e=t.call(this)||this;return n.isNonBrowserEnvironment()?e.impl={invoke:function(){return!1}}:r.isInClient()?e.impl=new u:e.impl=new f(window.sessionStorage),e}return e.__extends(i,t),Object.defineProperty(i.prototype,"name",{get:function(){return"isSubWindow"},enumerable:!1,configurable:!0}),i.prototype.install=function(){return this.impl.invoke.bind(this.impl)},i}(o.LiffModule),c=new s,a=c.install();exports.IsSubWindowModule=s,exports.isSubWindow=a,exports.module=c;
