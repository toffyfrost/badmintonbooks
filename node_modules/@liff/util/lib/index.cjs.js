"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@liff/logger"),e=require("tslib"),t=require("@liff/consts");function n(r){return window.atob(r.replace(/-/g,"+").replace(/_/g,"/"))}var o={decode:n,encode:function(r){return window.btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},decodeUnicode:function(r){var e=n(r).split("").map((function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)})).join("");return decodeURIComponent(e)}};function i(r){return parseInt(r,16)}var a={get:function(r){var e=new RegExp("(?:(?:^|.*;\\s*)".concat(r,"\\s*\\=\\s*([^;]*).*$)|^.*$"));return document.cookie.replace(e,"$1")},set:function(e,t,n){var o=e+"="+t;if(n)for(var i in n){var a=n[i]?"=".concat(n[i]):"";o+="; ".concat(i).concat(a)}r.logger.debug("set cookie",o),document.cookie=o},remove:function(r,e){var t="".concat(r,"=; expires=Thu, 01 Jan 1970 00:00:00 GMT");if(e)for(var n in e)t+="; ".concat(n,"=").concat(e[n]);document.cookie=t}},c=new Set(["400","401","403","404","429","500"]),u=function(r){function t(e,t,n){var o=r.call(this,t,n)||this;return o.code=e,o}return e.__extends(t,r),t}(Error);var s=function(){function r(){this.map={}}return r.prototype.clear=function(){this.map={}},r.prototype.getItem=function(r){var e=this.map[r];return void 0===e?null:e},r.prototype.setItem=function(r,e){this.map[r]=e},r.prototype.removeItem=function(r){delete this.map[r]},r.prototype.key=function(r){var e=Object.keys(this.map)[r];return void 0===e?null:e},Object.defineProperty(r.prototype,"length",{get:function(){return Object.keys(this.map).length},enumerable:!1,configurable:!0}),r}();var f,p={parse:function(r){return r.replace(/^\?/,"").replace(/^#\/?/,"").split(/&+/).filter((function(r){return r.length>0})).reduce((function(r,t){var n=e.__read(t.split("=").map(decodeURIComponent),2),o=n[0],i=n[1],a=r[o];return Array.isArray(a)?a.push(i):Object.prototype.hasOwnProperty.call(r,o)?r[o]=[a,i]:r[o]=i,r}),{})},stringify:function(r){return Object.keys(r).map((function(e){var t=r[e],n=function(r){return void 0!==r?"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(r)):encodeURIComponent(e)};return Array.isArray(t)?t.map((function(r){return n(r)})).join("&"):n(t)})).join("&")}},d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function l(){return window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967296}function v(r){var e=new URL(r),n=e.hash.slice(1).split("&").filter((function(r){return!t.CREDENTIAL_KEYS.some((function(e){return r.startsWith("".concat(e,"="))}))})).join("&");return e.hash=n,e.toString()}function g(r){var t=new URL(r);return t.toString().replace(new RegExp(String.raw(h||(h=e.__makeTemplateObject(["^",""],["^",""])),t.origin)),"")}var h,m=((f={})[t.PERMANENT_LINK_ORIGIN]=function(){var r=w(t.PERMANENT_LINK_ORIGIN);return new RegExp("^".concat(r,"(\\d+-\\w+)"))},f[t.PERMANENT_LINK_ORIGIN_MINI]=function(){var r=w(t.PERMANENT_LINK_ORIGIN_MINI);return new RegExp("^".concat(r,"((\\d+-\\w+)|(\\w+$))"))},f);function w(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}exports.HTTPStatusCodes=c,exports.InMemoryStorage=s,exports.LiffError=u,exports.addParamsToUrl=function(r,t){if(!r)throw new Error("addParamsToUrl: invalid URL");var n=new URL(r);return Object.entries(t).forEach((function(r){var t=e.__read(r,2),o=t[0],i=t[1];n.searchParams.set(o,i)})),n.toString()},exports.base64Url=o,exports.compareVersion=function(r,e){if(r===e)return 0;for(var t=r.split("."),n=e.split("."),o=Math.max(t.length,n.length),i=0;i<o;i++){t[i]||(t[i]="0"),n[i]||(n[i]="0");var a=parseInt(t[i])-parseInt(n[i]);if(0!==a)return a>0?1:-1}return 0},exports.convertArgbToRgba=function(e){var t=e.replace("#","").match(/.{2}/g)||[];if(4!==t.length)return r.logger.warn("convertArgbToRgba: Received invalid ARGB color"),"";var n=function(r){var e=i(r);return Math.round(e/255*100)/100}(t[0]),o=i(t[1]),a=i(t[2]),c=i(t[3]);return"rgba(".concat(o,", ").concat(a,", ").concat(c,", ").concat(n,")")},exports.convertArrayBuffer=function(r){for(var e=r.length,t=new ArrayBuffer(e),n=new Uint8Array(t),o=0;o<e;o++)n[o]=r.charCodeAt(o);return t},exports.convertHexToRgb=function(e){var t=e.replace("#","").match(/.{2}/g)||[];if(3!==t.length)return r.logger.warn("convertArgbToRgba: Received invalid hex color"),"";var n=i(t[0]),o=i(t[1]),a=i(t[2]);return"".concat(n,", ").concat(o,", ").concat(a)},exports.cookie=a,exports.createLiffError=function(r,e,t){return(null==t?void 0:t.cause)&&console.error("This is the cause of LiffError described below.",t.cause),new u(r,e||"",t||{})},exports.extractChannelIdFromLiffId=function(r){var e=r.match(/([^-]+)-[^-]+/);return e&&e[1]},exports.extractLiffId=function(r){for(var e in m){var t=r.match(m[e]());if(t)return t[1]}return null},exports.getOriginOfUrl=function(r){var e=r.match(/^(https?:\/\/.*?)\//);return e&&e[1]||""},exports.getRandomValue=l,exports.hexToBase64=function(r){var e="";return r.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").forEach((function(r){e+=String.fromCharCode(parseInt(r))})),window.btoa(e)},exports.isIE=function(r){void 0===r&&(r=window.navigator.userAgent);var e=r.toLowerCase();return-1!==e.indexOf("msie")||-1!==e.indexOf("trident")},exports.isIpad=function(r){return void 0===r&&(r=window.navigator.userAgent),/ipad/.test(r.toLowerCase())},exports.isLIFFBrowser=function(r){return void 0===r&&(r=window.navigator.userAgent),/Line\/\d+\.\d+\.\d+ LIFF/.test(r)},exports.isLINEBrowser=function(r){return void 0===r&&(r=window.navigator.userAgent),/Line\/\d+\.\d+\.\d+/.test(r)},exports.isLineCustomUrlScheme=function(r){return r.startsWith("line:")},exports.isNonBrowserEnvironment=function(){return"undefined"==typeof window},exports.isSubWindow=function(r){return void 0===r&&(r=window.navigator.userAgent),/LIFF\/SubWindow/.test(r)},exports.qs=p,exports.randomAlphaNumericString=function(r){for(var e="",t=0;t<r;t++)e+=d[Math.floor(l()*d.length)];return e},exports.removeCredential=v,exports.removeOrigin=g,exports.replaceUrlCredentialRemoved=function(r){var e=v(r);if(e!==r){var t=g(e);window.history.replaceState(history.state,"",t)}};
